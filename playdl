#!/bin/bash
cd /tmp
PlayName=$(zenity --entry --title="Playlist title?" --text="Title: ")
zenity --info --text="Please pick the download location for the audio"
AudioLocation=$(zenity --file-selection --directory)
zenity --info --text="Please pick the download location for the video"
VideoLocation=$(zenity --file-selection --directory)
PlayLink=$(zenity --entry --title="Please enter the YouTube url" --text="Link: ")
MaxVidSize="250M"
MaxVidSize=$(zenity --entry --title="Please enter the maximum video filesize: (press cancel for the default 250MB)" --text="Size (in megabytes): ")
MaxVidSize+="M"
cd $AudioLocation
mkdir $PlayName
cd $PlayName
(xterm -e youtube-dl -i -c -x --retries infinite -f 'bestaudio[ext=m4a]' --audio-quality 0 --no-overwrites --add-metadata --embed-thumbnail --youtube-skip-dash-manifest -o '0%(playlist_index)s-%(title)s.%(ext)s' --exec "ffmpeg -i {}  -codec:a libmp3lame -qscale:a 0 {}.mp3 && rm {} " $PlayLink) |
zenity --progress \
	--title="Downloading audio" \
	--text="Fetching files from YouTube... Close the xterm window to stop the download." \
	--percentage=0 \
	--pulsate \
	--auto-close \
	--auto-kill \
	--time-remaining
if [ "$?" = -1 ] ; then
        zenity --error \
          --text="Download canceled."
fi
cd $VideoLocation
mkdir $PlayName
cd $PlayName
(xterm -e youtube-dl -i -c --retries infinite --audio-quality 0 -f 'bestvideo[ext=mp4][height<=1080][height>=360]+bestaudio' --max-filesize MaxVidSize --no-overwrites --add-metadata --write-auto-sub --youtube-skip-dash-manifest --embed-thumbnail --embed-subs -o '0%(playlist_index)s-%(title)s.%(ext)s' $PlayLink) |
zenity --progress \
	--title="Downloading video" \
	--text="Fetching video from YouTube... Close the xterm window to stop the download." \
	--percentage=0 \
	--pulsate \
	--auto-close \
	--auto-kill \
	--time-remaining
if [ "$?" = -1 ] ; then
        zenity --error \
          --text="Download canceled."
fi
zenity --info --text="Success."
